{% if message.time_since.days > 365 %}
    {# different year#}
    <span>{{ message.sent|date:"d F Y" }}</span>
{% elif message.time_since.days > 1 and message.time_since.days <= 365 %}
    {# same year but different day #}
    <span>{{ message.sent|date:"d F" }}</span>
{% else %}
    {# the same day#}
    <span>{{ message.sent|time:"H:i" }}</span>
{% endif %}